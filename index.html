<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pinekin</title>
  <style>
    html, body { height: 100%; margin: 0; background:#0f172a; }
    #game { position: fixed; inset: 0; display: grid; place-items: center; }
    .overlay { position: fixed; left: 1rem; top: 1rem; color: #e2e8f0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, 'Helvetica Neue', Arial, 'Apple Color Emoji','Segoe UI Emoji';}
    .overlay small { opacity:.8 }
    .btn { cursor:pointer; padding:.4rem .7rem; border-radius:.6rem; background:#1f2937; color:#e5e7eb; border:1px solid #334155; }
    .btn:hover { background:#111827 }
  </style>
</head>
<body>
  <div id="game"></div>
  <div class="overlay">
    <div style="display:flex; gap:.5rem; align-items:center; margin-bottom:.5rem">
      <button id="pauseBtn" class="btn" title="Pause/Resume (P)">‚èØ Pause</button>
      <button id="spawnBtn" class="btn" title="Add more Kin (K)">‚ûï Kin</button>
    </div>
    <div><strong>Pine Kin</strong></div>
    <small>Move: ‚Üê ‚Üí ‚Üë ‚Üì or WASD ¬∑ Dash: Space ¬∑ Pointer: hold to steer</small>
  </div>

  <!-- PIXI.js v7 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.4.0/dist/pixi.min.js"></script>
  <script>
  (function(){
    const app = new PIXI.Application({
      background: '#0b1025',
      antialias: true,
      resolution: Math.min(window.devicePixelRatio || 1, 2),
      autoDensity: true,
      hello: true,
    });

    const root = document.getElementById('game');
    root.appendChild(app.view);

    function resize(){
      const w = window.innerWidth;
      const h = window.innerHeight;
      app.renderer.resize(w, h);
      bg.width = w; bg.height = h;
    }
    window.addEventListener('resize', resize);

    const stage = app.stage;
    const bg = new PIXI.Graphics();
    stage.addChild(bg);

    const world = new PIXI.Container();
    stage.addChild(world);

    const hud = new PIXI.Container();
    stage.addChild(hud);

    function drawBackground(){
      const w = app.renderer.width, h = app.renderer.height;
      bg.clear();
      bg.beginFill(0x0b1025); bg.drawRect(0,0,w,h); bg.endFill();
      for(let i=0;i<Math.floor((w*h)/25000);i++){
        const x = Math.random()*w; const y = Math.random()*h; const r = Math.random()*1.6+0.2;
        bg.beginFill(0xffffff, Math.random()*0.6+0.2);
        bg.drawCircle(x,y,r);
        bg.endFill();
      }
    }

    function hit(a,b){
      const dx=a.x-b.x, dy=a.y-b.y; const r=a.r+b.r; return dx*dx+dy*dy <= r*r;
    }

    function makePine(){
      const g = new PIXI.Graphics();
      g.beginFill(0x8b5a2b); g.drawRoundedRect(-10,10,20,24,4); g.endFill();
      const greens = [0x0ea5e9, 0x22c55e, 0x16a34a].sort(()=>Math.random()-0.5);
      let y=4, w=56;
      for(let i=0;i<4;i++){
        g.beginFill(greens[i%greens.length]);
        g.moveTo(0,y-8); g.lineTo(-w/2,y+12); g.lineTo(w/2,y+12); g.closePath(); g.endFill();
        y -= 10; w -= 10;
      }
      g.beginFill(0xffffff); g.drawCircle(-6,-6,3); g.drawCircle(6,-6,3); g.endFill();
      g.beginFill(0x000000); g.drawCircle(-6,-6,1.5); g.drawCircle(6,-6,1.5); g.endFill();
      g.beginFill(0xffd166); g.drawCircle(0,2,2); g.endFill();

      const c = new PIXI.Container();
      c.addChild(g);
      c.x = app.renderer.width/2; c.y = app.renderer.height/2;
      c.vx = 0; c.vy = 0; c.r = 18;
      c.speed = 0.6; c.friction = 0.92; c.max = 5; c.dash = 0;
      return c;
    }

    function makeKin(){
      const g = new PIXI.Graphics();
      const hue = Math.floor(40+Math.random()*40);
      const color = PIXI.utils.string2hex(`hsl(${hue}, 80%, 60%)`);
      g.beginFill(color);
      g.drawPolygon([0,-8, 8,8, -8,8]);
      g.endFill();
      const c = new PIXI.Container();
      c.addChild(g);
      c.x = Math.random()*app.renderer.width;
      c.y = Math.random()*app.renderer.height;
      c.r = 9; c.t = 0;
      return c;
    }

    function burst(x,y,n=12){
      for(let i=0;i<n;i++){
        const p = new PIXI.Graphics();
        p.beginFill(0xffffff); p.drawCircle(0,0, Math.random()*2+1); p.endFill();
        p.x=x; p.y=y; p.alpha=1; p.vx=(Math.random()-0.5)*6; p.vy=(Math.random()-0.5)*6; p.drag=0.96;
        particles.addChild(p);
      }
    }

    const pine = makePine();
    world.addChild(pine);

    const kins = new PIXI.Container(); world.addChild(kins);
    const particles = new PIXI.Container(); world.addChild(particles);

    function spawn(n=8){ for(let i=0;i<n;i++){ kins.addChild(makeKin()); } }
    spawn(10);

    const scoreText = new PIXI.Text('Kin: 0', {fill:'#e2e8f0', fontFamily:'ui-sans-serif, system-ui', fontSize: 18});
    scoreText.x = 16; scoreText.y = 54; hud.addChild(scoreText);

    const titleText = new PIXI.Text('Pine Kin', {fill:'#a5b4fc', fontFamily:'ui-sans-serif, system-ui', fontSize: 22, fontWeight:'700'});
    titleText.x=16; titleText.y=24; hud.addChild(titleText);

    let score = 0; let paused = false; let pointerDown=false; let pointer = {x:0,y:0};

    const keys = new Set();
    window.addEventListener('keydown', (e)=>{
      if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' ','Space','w','a','s','d','W','A','S','D','p','P','k','K'].includes(e.key)) e.preventDefault();
      keys.add(e.key);
      if(e.key === 'p' || e.key==='P') togglePause();
      if(e.key === 'k' || e.key==='K') spawn(5);
    });
    window.addEventListener('keyup', (e)=> keys.delete(e.key));

    // Use Pixi's interaction system (v7)
app.stage.interactive = true;
app.stage.on('pointerdown', (event)=>{ pointerDown = true; pointer = event.data.global; });
app.stage.on('pointerup', ()=> { pointerDown = false; });
app.stage.on('pointerupoutside', ()=> { pointerDown = false; });
app.stage.on('pointermove', (event)=>{ pointer = event.data.global; });

    document.getElementById('pauseBtn').onclick = togglePause;
    document.getElementById('spawnBtn').onclick = ()=>spawn(5);

    function togglePause(){ paused = !paused; pauseScreen.visible = paused; }

    const pauseScreen = new PIXI.Container(); stage.addChild(pauseScreen); pauseScreen.visible=false;
    const shade = new PIXI.Graphics(); shade.beginFill(0x000000, 0.45).drawRect(0,0,1,1).endFill(); pauseScreen.addChild(shade);
    const pauseLabel = new PIXI.Text('Paused', {fill:'#e5e7eb', fontSize: 42, fontWeight: '800'}); pauseLabel.anchor.set(0.5); pauseScreen.addChild(pauseLabel);

    function layoutPause(){
      shade.width = app.renderer.width; shade.height = app.renderer.height;
      pauseLabel.x = app.renderer.width/2; pauseLabel.y = app.renderer.height/2;
    }

    app.ticker.add((delta)=>{
      if(paused){ return; }

      const dt = Math.min(delta, 2.5);

      let ax=0, ay=0;
      if(keys.has('ArrowLeft') || keys.has('a') || keys.has('A')) ax -= 1;
      if(keys.has('ArrowRight') || keys.has('d') || keys.has('D')) ax += 1;
      if(keys.has('ArrowUp') || keys.has('w') || keys.has('W')) ay -= 1;
      if(keys.has('ArrowDown') || keys.has('s') || keys.has('S')) ay += 1;

      if(pointerDown){
        const dx = pointer.x - pine.x; const dy = pointer.y - pine.y;
        const len = Math.hypot(dx,dy) || 1;
        ax += (dx/len);
        ay += (dy/len);
      }

      if(keys.has(' ') || keys.has('Space')){
        if(pine.dash <= 0){ pine.vx += ax*6; pine.vy += ay*6; pine.dash = 28; burst(pine.x, pine.y, 20); }
      }
      pine.dash = Math.max(0, pine.dash - dt);

      pine.vx += ax * pine.speed * dt;
      pine.vy += ay * pine.speed * dt;
      const mag = Math.hypot(pine.vx, pine.vy);
      if(mag > pine.max){ pine.vx = (pine.vx/mag)*pine.max; pine.vy = (pine.vy/mag)*pine.max; }
      pine.x += pine.vx; pine.y += pine.vy;
      pine.vx *= pine.friction; pine.vy *= pine.friction;

      const W = app.renderer.width, H = app.renderer.height, R = pine.r;
      if(pine.x < R){ pine.x=R; pine.vx = Math.abs(pine.vx); }
      if(pine.x > W-R){ pine.x=W-R; pine.vx = -Math.abs(pine.vx); }
      if(pine.y < R){ pine.y=R; pine.vy = Math.abs(pine.vy); }
      if(pine.y > H-R){ pine.y=H-R; pine.vy = -Math.abs(pine.vy); }

      for(const k of kins.children){
        k.t += 0.03*dt; k.y += Math.sin(k.t)*0.3; k.rotation += 0.01*dt;
        if(hit(pine,k)){
          burst(k.x,k.y,12);
          k.destroy();
          score++; scoreText.text = `Kin: ${score}`;
        }
      }

      for(let i=kins.children.length-1;i>=0;i--){ if(kins.children[i].destroyed) kins.removeChildAt(i); }

      for(const p of particles.children){
        p.x += p.vx; p.y += p.vy; p.vx *= p.drag; p.vy *= p.drag; p.alpha *= 0.96; if(p.alpha < 0.03){ p.destroy(); }
      }
      for(let i=particles.children.length-1;i>=0;i--){ if(particles.children[i].destroyed) particles.removeChildAt(i); }
    });

    drawBackground();
    resize();
    layoutPause();

    window.addEventListener('resize', ()=>{ drawBackground(); layoutPause(); });

    console.log('%cüå≤ Pine Kin ready!','padding:6px 10px; background:#14532d; color:#eafff6; border-radius:8px');
  })();
  </script>
</body>
</html>

